<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="personalAccount">
	
	<select id="lookupAccount" parameterType="map" resultType="map">
		SELECT p.PRODUCTNAME, ac.accountNo, TO_CHAR(ac.createDate, 'YYYY-MM-DD HH24:MI:SS') createDate, TO_CHAR(trDate, 'YYYY-MM-DD HH24:MI:SS') trDate, balance
		FROM ACCOUNT ac
		LEFT OUTER JOIN TRANSACTION tr ON ac.ACCOUNTNO = tr.ACCOUNTNO
		LEFT OUTER JOIN PRODUCT p ON ac.PRODUCTIDX = p.PRODUCTIDX
		WHERE (ac.accountNO, TRDATE) IN (
		    SELECT accountNO, MAX(TRDATE) FROM TRANSACTION GROUP BY ACCOUNTNO
		) AND memberIdx = ${memberIdx} AND p.productIdx = ${productIdx}
		ORDER BY ac.ACCOUNTNO ASC
	</select>
	
	<select id="listAccount" parameterType="map" resultType="map">
		SELECT accountNo 
		FROM account
		WHERE memberIdx = #{memberIdx} 
			AND productIdx = #{productIdx}
	</select>
	
	<sql id="where-list">
		
	</sql>
</mapper>